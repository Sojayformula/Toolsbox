
<div class="container">
    <div class="mt-[-10rem] mx-2 md:mx-10">

      <!-- Fungate merchant text -->
      <div class="flex justify-between">
         <div class="text-white text-2xl font-semibold">
           Fundgate Authomation
           <p class="text-[10px] whitespace-nowrap">
            View and manage all fundgate authomation
          </p>
         </div>

         <!-- Enrol merchant and Log button -->
         <div class="space-x-3 space-y-3 md:space-y-0 mt-3 relative left-5 md:left-0">
          <button (click)="openCretaModalOpen()" class="text-white text-sm border border-cyan-400 py-1 px-2 md:w-[8rem]">
            Enrol Merchant
          </button>
          <button class="text-white text-sm border border-orange-500 bg-orange-500 rounded py-1 w-[6rem]">
            Logs
          </button>
         </div>
      </div>

    <div class="md:flex justify-between mt-2 md:mt-9">
        <div class="text-white space-x-2">
            <button (click)="exportTableToCSV()"
            class="bg-[#033028] border border-[#65661D] py-1 px-6 rounded-[6px] text-[12.76px]">
                Export
            </button>
        </div>

    </div>
    </div>



           <!-- Enrol merchant modal -->
         <div *ngIf="isCreateTicketOpen" (click)="closeCretaModalOpen()"  class="fixed inset-0 bg-black/40 flex items-center justify-center z-50
              transition-opacity duration-300"
            [class.opacity-100]="isVisible"
            [class.opacity-0]="!isVisible"
            (click)="closeCretaModalOpen()"
         >
           <div class="bg-white w-[23rem] md:w-[500px] max-h-[90vh] rounded-xl shadow-lg flex flex-col
            transform transition-all duration-300 ease-out "
            [class.translate-x-full]="!isVisible"
            [class.-translate-x-0]="isVisible"
            [class.opacity-100]="isVisible"
            [class.opacity-0]="!isVisible"
            (click)="$event.stopPropagation()" 
           >

                  <!-- Header -->
             <div class="flex items-center justify-between px-5 py-3 border-b">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                    ðŸŽ«
                    </div>
                      <p class="font-medium text">
                          Create Merchant
                      </p>
                    </div>

                    <button (click)="closeCretaModalOpen()"  class="text-gray-400 hover:text-gray-600">
                       âœ•
                    </button>
              </div>

  
              <!-- Tabs Content -->
          <div class="flex-1 overflow-y-auto px-6 py-4 ">

               <!-- Ticket Details -->
          <ng-container *ngIf="activeTab === 'Ticket details'" >
            
         <!-- form -->
        <form #form="ngForm" (ngSubmit)="onSubmit()" class="space-y-6">
         <!-- <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Name</label>
            <select
            name="name"
            [(ngModel)]="toolsModel.name"
            required
            class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let tag of toolsData" [value]="tag._id">
                {{ tag.name }}
            </option>
           </select>
          </div>  -->


          <!-- Source -->
           <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Source</label>
            <select
            name="name"
            [(ngModel)]="toolsModel.source"
            required
            class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let tag of toolsData" [value]="tag._id">
                {{ tag.source || 'N/A' }} 
            </option>
           </select>
          </div> 

          <div class="flex flex-col">
              <label>Email</label>
              <input
              type="text"
              name="email"
              [(ngModel)]="toolsModel.email"
              placeholder="Enter email"
              class="border border-[#D4D4D4] text-[#969696] w-[18rem] md:w-[20rem] py-1 px-4 rounded-[5px]"
              >
            </div>

        <!-- Country -->
           <!-- <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Country</label>
            <select
            name="country"
            [(ngModel)]="toolsModel.email"
            required
            class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let user of toolsData" [value]="user._id">
                {{user.country || 'N/A'}}
            </option>
           </select>
          </div>  -->

          

          <!-- Email -->
           <!-- <div *ngFor="let email of emails; let i = index" class="flex">
          <div class="flex flex-col">
              <label>Email</label>
              <input
              type="text"
              [name]="'email'+ i"
              [(ngModel)]="email[i]"
              placeholder="Enter email"
              class="border border-[#D4D4D4] text-[#969696] w-[18rem] md:w-[20rem] py-1 px-4 rounded-[5px]"
              >
            </div> -->

            <!-- Add more email and Delete button -->
             <!-- <div class="md:flex gap-2 mx-2 md:mx-8 mt-3 md:mt-6">
              <div class="flex justify-center items-center bg-blue-100 rounded-full mt-[px] w-[30px] h-[30px]">
              <button class="text-white text-[20px] rounded-full bg-blue-500 w-[18px] h-[18px] flex items-center justify-center">
                +
              </button>
              </div>
              <div *ngIf="emails.length > 1" class="flex justify-center items-center bg-red-100 rounded-full w-7 h-7">
              <button>
                  <span  class="material-symbols-outlined text-red-500 text-[19px] flex">
                     delete
                   </span>
              </button>
              </div>
             </div>
            </div> -->
          

          <!-- Grid fields -->
          <div class="grid md:grid-cols-2 md:gap-2 gap-y-8 md:gap-y-0">
            <div class="flex flex-col">
              <label>Lower Limit</label>
              <input
              type="text"
              name="lowerlimit"
              [(ngModel)]="toolsModel.lowerTreshold"
              placeholder=""
              class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
              >
            </div>

             <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Frequency</label>
            <select
            name="frequency"
            [(ngModel)]="toolsModel.frequency"
            required
            class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let tag of toolsData" [value]="tag._id">
               {{tag.frequency}}
            </option>
           </select>
          </div> 
          </div>

          <!-- Add merchant button -->
          <div class="flex justify-end">
              <button type="submit" class="bg-gradient-to-b from-[#00203D] to-[#0056A3] border-2 border-[#B3B3B361] rounded text- [10.35px] text-white w-[8rem] px-2 py-1">
                Add Merchant
              </button>
            </div>
            <!-- (click)="createTicket()" -->
          
          </form>
      </ng-container>



        <!-- Mail -->
          <ng-container *ngIf="activeTab === 'Mail'">
            <div class="flex gap-6 text-sm text-gray-600 mt-10">
              <div class="mt-[7px]">
                <p class="text-center bg-[#CBCBCB] border-2 border-[#9A9A9A] w-[40px] h-[38px] rounded-full py-1">
                    p
                </p>
               </div>
              <div >
                <!-- <p class="font-bold">{{mail.emailThread.from}} </p>
                <p  class="mt-[10px]">
                    {{mail.subject}}
              </p> -->
              <ul *ngFor="let mail of toolsData">
                <li>{{mail.emailThread.from}} </li>
                <li>{{mail.subject}}</li>
              </ul>
              </div>
             
            </div>
           </ng-container> 


           <!-- Comments -->
          <ng-container *ngIf="activeTab === 'Comments'">
            <p class="text-sm text-gray-600">
              Comments content goes here...
             </p>
           </ng-container> 

    </div>

  </div>
</div>



<!-- Delete Modal -->
 <div *ngIf="showDeleteModal" class="bg-black/50 fixed inset-0 ">
    <div class="flex justify-center mt-[15rem]">
      <div class=" bg-white w-[25rem] h-[15rem] rounded-[10px]">
       
          <div class="flex justify-center mt-6 font-bold">Delete merchant?</div>

          <div class="flex justify-center relative top-[10px]">
          <div class="flex justify-center items-center bg-red-100 rounded-full w-10 h-10">
           <span  class="material-symbols-outlined fle x  justify-center text-red-600 text-[25px]">
               delete
           </span>
          </div>
        </div>

        <div class="mt-5">
          <div class="flex justify-center mx-10">
            Are you sure you want to delete this merchant?
            This action cannot be undone.
           </div>
           <div class="flex gap-2 justify-end mt-7 mx-5">
              <button (click)="closeDeleteTicketModal()"
             class="bg-gray-600 text-white rounded px-4 py-1">
             Cancel
            </button>

             <button (click)="deleteTicket()"
             class="bg-red-500 text-white rounded-4 px-4 py-1">
             Delete
            </button>
           </div>
        </div>
      </div> 
    </div>
 </div>




               <!-- Edit  -->
           <div *ngIf="isEditModalOpen" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
            <div class="bg-white w-[23rem] md:w-[500px] max-h-[90vh] rounded-xl shadow-lg flex flex-col">

                  <!-- Header -->
             <div class="flex items-center justify-between px-5 py-3 border-b">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                    ðŸŽ«
                    </div>
                      <p class="font-medium text">
                          Create Merchant
                      </p>
                    </div>

                    <button (click)="closeEditModal()"  class="text-gray-400 hover:text-gray-600">
                       âœ•
                    </button>
              </div>

  
              <!-- Edit fundgate -->
          <div class="flex-1 overflow-y-auto px-6 py-4 ">  
          
         <!-- form -->
        <form #form="ngForm" (ngSubmit)="editMerchant()" class="space-y-6">
          <div class="flex flex-col">
              <label>Email</label>
              <input
              type="text"
              name="email"
              placeholder="Enter email"
              class="border border-[#D4D4D4] text-[#969696] w-[18rem] md:w-[20rem] py-1 px-4 rounded-[5px]"
              >
            </div>

          
            <div class="flex flex-col">
              <label>Lower Limit</label>
              <input
              type="text"
              name="lowerlimit"
              placeholder=""
              class="border border-[#D4D4D4] text-[#969696] py-1 px-4 rounded-[5px]"
              >
            </div>

             <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Frequency</label>
             huihuho
          </div> 
          

          <!-- Add merchant button -->
          <div class="flex justify-end">
              <button type="submit" class="bg-gradient-to-b from-[#00203D] to-[#0056A3] border-2 border-[#B3B3B361] rounded text- [10.35px] text-white w-[8rem] px-2 py-1">
                Add Merchant
              </button>
            </div>

          </form>
          </div>
        </div>
      </div>
    




  <!-- Page loader -->
    <div *ngIf="isLoading" class="flex gap-4 justify-center relative top-[3rem] ">
      <span class="loader"></span>
   </div>


             <!-- Table -->
   <div class="mt-10 md:mt-10 md:mx-4 overflow-auto">
        <table class="w-full mt-6" id="ticketData">
            <thead class=" bg-[#00203D] text-white text-[10px] md:text-[16px] text-left">
                <tr class="whitespace-nowrap ">
                     <th class="p-4 md:p- 3 rounded-tl-[10px]">EMAIL</th>
                    <th class="p-4 md:p- 3">MERCHANT NAME</th>
                    <th class="p-4 md:p- 3">BALANCE</th>
                    <th class="p-4 md:p- 3">LOWER LIMIT</th>
                    <th class="p-4 md:p- 3">FREQUENCY</th>
                    <th class="p-4 md:p- 3">STATUS</th>
                    <th class="p-4 md:p- 3 rounded-tr-[10px]">ACTION</th>
                </tr>
            </thead>
            <tbody >
                <tr *ngFor="let ticket of toolsData" class="border-b ">
                    <td class="p-4 md:p-3  max-w-[220px] truncate break-all" title="{{ ticket.email }}">{{ticket.email}}</td>
                     <td class="p-4 md:p-3 [40px]  max-w-[120px]">{{ticket.name}}</td>
                      <td class="p-4 md:p-3 ">{{ticket.balance}}</td>
                      <td class="p-4 md:p-3  ">{{ticket.lowerTreshold}}</td>
                      <td class="p-4 md:p-3  ">{{ticket.frequency}}</td>
                    
                    <td class="p-4 md:p-3">
                        <div
                         class="rounded px-3 py-1 text-xs text-center flex items-center"
                          [ngClass]="{
                        'bg-[#B61E002B] border-[2px] border-[#B61E00] text-[#B61E00] w-[72px] h-[25px] rounded-[9px]': ticket.status === 'PENDING',
                        'bg-yellow-100 [#FFBF4024] border-2 border-yellow-700 [#FFBF405c] text-[#FFBF40] w-[71px] h-[24px] rounded-lg': ticket.status === 'INACTIVE',
                        'bg-green-100 border-2 border-green-600 text-green-800 w-[70px] h-[24px] rounded-[8px]': ticket.status === 'ACTIVE',
                        }"
                        >
                          {{ticket.status}}  
                        </div>
                    </td>

                      <td class="p-4 md:p-3">
                        <div class="flex"> 
                      <button (click)="openDeleteTicketModal(ticket._id)">
                         <span  class="material-symbols-outlined text-red-500">
                           delete
                         </span>
                       </button>

                      <button (click)="openEditModal(ticket._id)">
                         <span class="material-symbols-outlined text-blue-500">
                            stylus_note
                         </span>
                      </button>
                      </div>
                    </td>
                  
                </tr>
            </tbody>
        </table>
    </div>

</div>

        <!-- PAGINATION -->
          <div class="flex justify-between items-center px-2 m-2 mb-10">
          <div></div>
            <div class="flex w-[90%] md:w-[70%] lg:w-[30%] text-[12px] md:text-[16px]">
                <nz-pagination
                [nzTotal]="50"
                (nzPageIndexChange)="onPageChange($event)">
                
                </nz-pagination>
              </div>
          </div> 