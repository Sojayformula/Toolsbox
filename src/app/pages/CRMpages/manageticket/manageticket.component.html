<div class="container">
    <div class="mt-[-10rem] mx-5 md:mx-10">
         <div class="text-white text-2xl font-semibold">
        Manage Ticket
        <p class="text-[10px]">View and manage all tickets</p>
    </div>

    <div class="md:flex justify-between mt-2 md:mt-9">
        <div class="text-white space-x-2">
            <button (click)="openCretaModalOpen()"  class="bg-blue-700 py-1 px-4 rounded-[6px] text-[12.76px] ">
                Create ticket
                <span class="rounded-full border border-white px-[0.9px] text-[8px]">+</span>
            </button>
            <button (click)="exportTableToCSV()"
            class="bg-[#033028] border border-[#65661D] 900 py-1 px-6 rounded-[6px] text-[12.76px]">
                Export
            </button>
        </div>

        <!-- Search input and filter button -->
         <div class="flex gap-2">
        <div>
            <input
            type="text"
            name="search"
            [(ngModel)]="searchQuery"
            (input)="onSearchChange()"
            placeholder="search report"
            class="bg-[#3B4758A1] rounded-[6px] px-[20px] py-2 text-white text-[14px] mt-2 md:mt-0 w-[17rem] md:w-[18rem]"
            >
        </div>

        <div class="flex justify-center bg-white w-10 h-[2rem] md:h-[2.2rem] mt-3 md:mt-0 rounded">
          <button (click)="isFilterModalOpen()">
            <img src="/filter.png">
           </button>
        </div>
      </div>
    </div>
    </div>



     <!-- Filter modal -->
       <div *ngIf="isFilterOpen" class="fixed inset-0 z-10 bg-black/50">
        <div class="flex justify-center mt-[8rem]">
        <div class=" bg-white w-[22rem] ">

                <div class="flex items-center justify-between px-5 py-3 border-b">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                    ðŸŽ«
                </div>
                  <p class="font-medium text-sm">
                    Filter
                  </p>
                </div>

                    <button (click)="closeFilterModal()"  class="text-gray-400 hover:text-gray-600">
                       âœ•
                    </button>
              </div>

             <form #form="ngForm" (ngSubmit)="openFilterModalOpen()">  
            <div class="space-y-4 mt-[2rem] mx-5">
                 <div class="flex flex-col">
                    <label>Priority</label>
                    <select 
                    name="status"
                    [(ngModel)]="ticketModel.priority"
                    class="border px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500">
                        <option value="" disabled selected hidden>Select priority</option>
                        <option value="HIGH" >High</option>
                        <option value="MEDIUM" >Medium</option>
                        <option value="LOW" >Low</option>
                    </select>
                </div>

                <div class="flex flex-col">
                    <label>Status</label>
                    <select 
                    name="status"
                    [(ngModel)]="ticketModel.status"
                    class="border px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500">
                        <option value="" disabled selected hidden>Select status</option>
                        <option value="OPEN">Open</option>
                         <option value="CLOSE">Close</option>
                          <option value="ESCALATED">Escalated</option>
                    </select>
                </div>

                  <div class="flex flex-col">
                    <label>start Date</label>
                    <input
                    type="date"
                    name=""
                    [(ngModel)]="ticketModel.startDate"
                    placeholder=""
                    class="border px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500"
                    >
                </div>

                <div class="flex flex-col">
                    <label>End Date</label>
                    <input
                    type="date"
                    name=""
                    [(ngModel)]="ticketModel.endDate"
                    placeholder=""
                    class="border px-2 py-1 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500"
                    >
                </div>
               </div>
                <div class="flex justify-end gap-2 mt-10 mb-5 mx-5">
                    <button (click)="resetFilters(form)"
                         class="text-red-500 text-sm underline" class="bg-gray-500 px-5 py-1 text-white text-sm rounded "
                         >
                         Reset
                    </button>
                    <button type="submit" class="bg-blue-500 px-5 py-1 text-white text-sm rounded">
                        Apply
                    </button>
                </div>
              </form> 
             </div>
          </div>
        </div>




           <!-- Create ticket modal -->
         <div *ngIf="isCreateTicketOpen" (click)="closeCretaModalOpen()"  class="fixed inset-0 bg-black/40 flex items-center justify-center z-50
         transition-opacity duration-300"
       [class.opacity-100]="isVisible"
       [class.opacity-0]="!isVisible"
       (click)="closeCretaModalOpen()"
         >
           <div class="bg-white w-[700px] max-h-[90vh] rounded-xl shadow-lg flex flex-col
            transform transition-all duration-300 ease-out"
    [class.translate-x-0]="isVisible"
    [class.-translate-x-full]="!isVisible"
    [class.opacity-100]="isVisible"
    [class.opacity-0]="!isVisible"
    (click)="$event.stopPropagation()" 
           >

                  <!-- Header -->
             <div class="flex items-center justify-between px-5 py-3 border-b">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                    ðŸŽ«
                </div>
                  <p class="font-medium text-sm">
                       Ticket ID : <span class="font-semibold">Etz-8644768</span>
                  </p>
                </div>

                    <button (click)="closeCretaModalOpen()"  class="text-gray-400 hover:text-gray-600">
                       âœ•
                    </button>
              </div>

   
              <!-- Tabs Content -->
          <div class="flex-1 overflow-y-auto px-6 py-4">
           
                <!-- Tabs -->
               <div  class="flex gap-8 px-6 border-b text-sm font-medium">
               <div class="space-x-4">
                 <button 
                   *ngFor="let tab of tabs"
                   (click)="setTab(tab)"
                   class="flex-1 py-2 text-sm"
                   [ngClass]="{
                  'border-b-2 border-black font-semibold': activeTab === tab,
                  'text-gray-500': activeTab !== tab
                }"
              >
                    {{ tab  }}
                   </button>
             </div>
           </div>

               <!-- Ticket Details -->
          <ng-container *ngIf="activeTab === 'Ticket details'" >
            <div class="flex justify-end">
              <button (click)="createTicket()" class="bg-gradient-to-b from-[#00203D] to-[#0056A3] border-2 border-[#B3B3B361] rounded-[59px] text-[10.35px] text-white px-2 py-1">
                Edit ticket
              </button>
            </div>

         <!-- Subject -->
        <div class="space-y-6">
         <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Subject</label>
            <input
            name="taggedUsers"
            [(ngModel)]="createTcketModel.subject"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
          </div> 

         <!-- Tag user -->
         <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Tag User</label>
            <select
            name="taggedUsers"
            [(ngModel)]="createTcketModel.taggedUsers"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let tag of taggedUsers" [value]="tag._id">
                {{ tag.assignedUser?.firstName }} {{ tag.assignedUser?.lastName }}
            </option>
           </select>
          </div> 

        <!-- Assign user -->
           <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Assign User</label>
            <select
            name="assignedUser"
            [(ngModel)]="createTcketModel.assignedUser"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Kojo Amewuga</option>
            <option *ngFor="let user of employeesData" [value]="user._id">
                {{user.firstName}} {{user.lastName}}
            </option>
           </select>
          </div> 


          <!-- Priority -->
           <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Priority</label>
          <select
            name="priority"
            [(ngModel)]="createTcketModel.priority"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Low</option>
            <option value="HIGH">HIGH</option>
            <option value="MEDIUM">MEDIUM</option>
            <option value="LOW">LOW</option>
            <option value="CRITICAL">CRITICAL</option>
           </select>
          </div> 

         <div class="flex flex-col">
            <label>Description</label>
             <textarea
               name=""
               [(ngModel)]="createTcketModel.description"
               class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] w-full py-4 px-4 rounded-[5px]"
            ></textarea>
         </div>

          <!-- Status -->
          <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Status</label>
            <select
            name="status"
            [(ngModel)]="createTcketModel.status"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>Open</option>
            <option value="OPEN">Open</option>
            <option value="CLOSE">Close</option>
            <option value="ESCALATED">Escalate</option>
           </select>
          </div> 

          <!-- Institution -->
           <div class="flex flex-col">
            <label class="text-[#353535] text-[13-px]">Istitution</label>
            <select
            name="istitution"
            [(ngModel)]="createTcketModel.placeholders.Institution"
            required
            class="border border-[#D4D4D4] bg-[#EFEFEF] text-[#969696] py-1 px-4 rounded-[5px]"
            >
            <option value="" disabled selected hidden>GCB</option>
            <option *ngFor="let item of ticketData" [value]="item._id" >
                {{item.placeholders.Institution}}
            </option>
           </select>
          </div> 
          
        </div>
      </ng-container>


        <!-- Mail -->
          <ng-container *ngIf="activeTab === 'Mail'">
            <div class="flex gap-6 text-sm text-gray-600 mt-10">
              <div class="mt-[7px]">
                <p class="text-center bg-[#CBCBCB] border-2 border-[#9A9A9A] w-[40px] h-[38px] rounded-full py-1">
                    p
                </p>
               </div>
              <div >
                <!-- <p class="font-bold">{{mail.emailThread.from}} </p>
                <p  class="mt-[10px]">
                    {{mail.subject}}
              </p> -->
              <ul *ngFor="let mail of ticketData">
                <li>{{mail.emailThread.from}} </li>
                <li>{{mail.subject}}</li>
              </ul>
              </div>
             
            </div>
           </ng-container> 


           <!-- Comments -->
          <ng-container *ngIf="activeTab === 'Comments'">
            <p class="text-sm text-gray-600">
              Comments content goes here...
             </p>
           </ng-container> 

    </div>

  </div>
</div>



<!-- Delete Modal -->
 <div *ngIf="showDeleteModal" (click)="closeDeleteTicketModal()" class="bg-black/50 fixed inset-0 ">
    <div class="flex justify-center mt-[15rem]">
      <div class=" bg-white w-[25rem] h-[15rem] rounded-[10px]">
          <div class="flex justify-center mt-6 font-bold">
            Delete merchant?
          </div>

          <div class="flex justify-center relative top-[10px]">
          <div class="flex justify-center items-center bg-red-100 rounded-full w-10 h-10">
           <span  class="material-symbols-outlined fle x  justify-center text-red-600 text-[25px]">
               delete
           </span>
          </div>
        </div>

        <div class="mt-5">
          <div class="flex justify-center mx-10">
            Are you sure you want to delete this merchant? 
            This action cannot be undone.
           </div>
           <div class="flex gap-2 justify-end mt-8 mx-5">
              <button (click)="closeDeleteTicketModal()"
             class="bg-gray-600 text-white rounded px-4 py-1">
             Cancel
            </button>

             <button (click)="deleteTicket()"
             class="bg-red-500 text-white rounded-4 px-4 py-1">
             Delete
            </button>
           </div>
        </div>
      </div> 
    </div>
 </div>



  <!-- Page loader -->
    <div *ngIf="isLoading" class="flex gap-4 justify-center relative top-[3rem] ">
      <span class="loader"></span>
   </div>


   <!-- Toggle select -->
<div class="mt-10 md:mt-5 md:mx-4 overflow-auto">
<div class="flex gap-3 md:gap-4 border md:py-1 px-2 bg-gray-100/60 rounded-[10px] mt-20 w-[35rem] md:w-[33rem]">
 <button (click)="toggle('All')"
 [ngClass]="{'text-white bg-gradient-to-b from-[#122C69] to-[#1D0434] px-2': selectedTab ==='All', 
  'text-[#838383]' : selectedTab !== 'All'
 }" 
 class="md:w- whitespace-nowrap 20 px-4 py-1 rounded-[10px] text-[20px] md:text-[16px]"
 >
    All
 </button>
    <button (click)="toggle('Onduty')"
    [ngClass]="{'text-white bg-gradient-to-b from-[#122C69] to-[#1D0434] px-2': selectedTab ==='Onduty', 
  'text-[#838383]' : selectedTab !== 'Onduty'
 }" 
     class="md:w- whitespace-nowrap 20 px-4 py-1 rounded-[10px] text-[20px] md:text-[16px]">
        Tagged Tickets
    </button>
    <button (click)="toggle('Approved')"
    [ngClass]="{'text-white bg-gradient-to-b from-[#122C69] to-[#1D0434] px-2': selectedTab ==='Approved', 
  'text-[#838383]' : selectedTab !== 'Approved'
 }" 
    class="md:w- whitespace-nowrap [20rem] py-1 rounded-[10px] text-[20px] md:text-[16px] ">
        Assigned Tickets
    </button>
    <button (click)="toggle('Decline')"
    [ngClass]="{'text-white bg-gradient-to-b from-[#122C69] to-[#1D0434] px-2': selectedTab ==='Decline', 
  'text-[#838383]' : selectedTab !== 'Decline'
 }" 
    class="md:w- 20 whitespace-nowrap py-1 rounded-[10px] text-[20px] md:text-[16px] ">
        Created Tickets
    </button>
</div>


                 <!-- Table -->
        <table class="w-full mt-6" id="ticketData">
            <thead class=" bg-[#00203D] text-white text-[14px] md:text-[16px] text-left">
                <tr class="whitespace-nowrap ">
                     <th class="p-4 md:p- 3 rounded-tl-[10px]">TICKET ID</th>
                      <th class="p-4 md:p- 3">SUBJECT</th>
                    <th class="p-4 md:p- 3">CREATED BY</th>
                    <th class="p-4 md:p- 3">ASSIGNED TO</th>
                    <th class="p-4 md:p- 3">PRIORITY</th>
                    <th class="p-4 md:p- 3">INSTITUTION</th>
                    <th class="p-4 md:p- 3">CREATED AT</th>
                    <th class="p-4 md:p- 3">UPDATED AT</th>
                    <th class="p-4 md:p- 3">STATUS</th>
                    <th class="p-4 md:p- 3  rounded-tr-[10px]">ACTION</th>
                </tr>
            </thead>
            <tbody >
                <tr *ngFor="let ticket of ticketData" class="odd:bg-gray-100 even:bg-white">
                     <td class="p-4 md:p-3">{{ticket.ref }}</td>
                      <td class="p-4 md:p-3 ">{{ticket.subject }}</td>
                    <td class="p-4 md:p-3  breat-all">{{ticket.createdByEmail}}</td>
                     <td class="p-4 md:p-3">{{ticket.Institution || 'N/A'}}</td>
                    <td class="p-4 md:p-3">
                        <div
                        class="rounded px-3 py-1 text-xs w-fi text-center"
                        [ngClass]="{
                        'bg-[#B61E002B] border-[2px] border- [#B61E00] text-[#B61E00] w-[73px] h-[25px] rounded-lg': ticket.priority === 'HIGH',
                        'bg-[#FFBF4024] border-2 border-[#FFBF405c] text-[#FFBF40] w-[70px] h-[24px] rounded-[8px]': ticket.priority === 'MEDIUM',
                        'bg-[#00B69B2B] border-2 border-[#00B69B] text-[#00B69B] w-[70px] h-[25px] rounded-[8px]': ticket.priority === 'LOW',
                        'bg-[#7C3AED2B] border-2 border- [#7C3AED] text-[#7C3AED] w-[72px] h-[26px] rounded-[8px]': ticket.priority === 'CRITICAL',
                        }"
                        >
                          {{ticket.priority}}
                        </div>
                    </td>

                    <td class="p-4 md:p-3">{{ticket.Insttution || 'N/A'  }}</td>
                     
                    <td class="p-4 md:p-3">
                        <div>{{ ticket.createdAt | date:'M/d/yy' }}</div>
                         <div class="text-xs text-gray-500">
                          {{ ticket.createdAt | date:'h:mm a' }}
                         </div>
                    </td>

                    
                    <td class="p-4 md:p-3">
                        <div>{{ ticket.updatedAt | date:'M/d/yy' }}</div>
                         <div class="text-xs text-gray-500">
                          {{ ticket.updatedAt | date:'h:mm a' }}
                         </div>
                    </td>
                    
                    <td class="p-4 md:p-3">
                        <div
                         class="rounded px-3 py-1 text-xs text-center"
                         [ngClass]="{
                        'bg-[#B61E002B] border-[2px] border-[#B61E00] text-[#B61E00] w-[73px] h-[25px] rounded-lg': ticket.status === 'OPEN',
                        'bg-[#FFBF4024] border-2 border-[#FFBF405c] text-[#FFBF40] w-[70px] h-[24px] rounded-[8px]': ticket.status === 'CLOSE',
                        'bg-[#00B69B2B] border-2 border-[#00B69B] text-[#00B69B] w-[70px] h-[25px] rounded-[8px]': ticket.status === 'ESCALATED',
                        }"
                        >
                          {{ticket.status}}
                        </div>
                    </td>
                    <td class="p-4 md:p-3">
                        <div class="flex"> 
                      <button (click)="openDeleteTicketModal(ticket._id)">
                         <span  class="material-symbols-outlined text-red-500">
                           delete
                         </span>
                       </button>

                      <button >
                         <span class="material-symbols-outlined text-blue-500">
                            stylus_note
                         </span>
                      </button>
                      </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

        <!-- PAGINATION -->
          <div class="flex justify-between items-center px-2 m-2 mb-10">
          <div></div>
            <div class="flex w-[90%] md:w-[70%] lg:w-[30%] text-[12px] md:text-[16px]">
                <nz-pagination
                [nzTotal]="50"
                (nzPageIndexChange)="onPageChange($event)">
                
                </nz-pagination>
              </div>
          </div> 

    




  








                <!-- Tabs   (click)="selectTab(tab)" -->
              <!-- <div class="flex gap-8 px-6 border-b text-sm font-medium">
               <div class="space-x-4">
                 <button
                   *ngFor="let tab of tabs"
                   (click)="setTab(tab)"
                   class="flex-1 py-2 text-sm"
                   [ngClass]="{
                  'border-b-2 border-black font-semibold': activeTab === tab,
                  'text-gray-500': activeTab !== tab
                }"
              >
                    {{ tab  }}
                   </button>
             </div>
           </div> -->




            <!-- Comments -->
      <!-- <ng-container *ngIf="activeTab === 'Comments'">
        <p class="text-sm text-gray-600">
          Comments content goes here...
        </p>
      </ng-container> -->